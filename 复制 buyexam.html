<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title>考卷购买</title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="common/css/mui.min.css" rel="stylesheet" />
		<link href="common/css/fonts/font-awesome.min.css" rel="stylesheet" />
		<link href="common/css/swiper.min.css" rel="stylesheet" />
		<link href="common/css/icon.css" rel="stylesheet" />
		<link href="common/css/ui-base.css" rel="stylesheet" />
		<link href="common/css/ui-box.css" rel="stylesheet" />
		<link href="common/css/ui-color.css" rel="stylesheet" />
		<link href="common/css/common.css" rel="stylesheet" />
		<link href="common/css/control.css" rel="stylesheet" />
		<link href="maincss/lesson.css" rel="stylesheet" />
		<style>
			.swiper-button-next,
			.swiper-button-prev {
				width: 26px;
				height: 26px;
				border-radius: 50%;
				margin-top: -10px;
				z-index: 10;
				cursor: pointer;
				background-size: 15px 20px;
				background-color: rgba(0, 0, 0, .2);
				position: fixed;
				top: 78%;
			}
			.ctrlL{ height: 2em; width: 2em; background: #f5f5f5;}
			.ctrlR{height: 2em; width: 2em; background: #f5f5f5;}
			.ctrlN{height: 2em; padding: 0 0.6em;}
			.paperbox{  }
			.ctrlbox{ padding: 0.5em 0.6em; margin-bottom: 1px; background: #fff;}
			.delivebox{padding:0.6em; margin-bottom: 1px; background: #fff;}
			.buyfooter{ background: #fff; height: 3.2em; position: fixed; left: 0; bottom: 0; width: 100%; box-shadow: 0 -2px 3px #e1e1e1; z-index: 999;}
			.buybtn{ height: 100%; background: #ff8a4c; color: #fff;}
			.datalist{ padding-bottom: 3.5em;}
		</style>
	</head>

	<body class="bc-text um-vp bc-bg">
		<div class="ub ub-ver test_wraptop">
			<div class="lesson_topimg">
				<img class="subject_img" src="common/images/default.jpg" />
			</div>
			<div class="ub lesson_subnav">
				<div class="ub ub-f1 ub-fh ub-ac ub-pc switch_navitem curnav" id="video">
					<div class="ub">规格选择</div>
					<div class="ub navline"></div>
				</div>
				<div class="ub ub-f1 ub-fh ub-ac ub-pc switch_navitem" id="file">
					<div class="ub">文档说明</div>
				</div>
			</div>
			<div class="ub ub-ver lesson_infor">
				<div class="ub ub-ac marb06">
					<span class="leseeon_sign finetest_class"></span>
					<span class="finetest_name"></span>
				</div>
				<div class="ub">
					<div class="ub sc-text ub-f1 dhide">
						<div class="ub ub-ac">
							<img class="ub ub-img track_img" src="common/images/track.png" />
						</div>
						<div class="ub ub-ac ub-pc ft085 ub-pc">
							<span class="testlook">0</span><span>浏览</span>
						</div>
					</div>
					<div class="ub ub-f1 ub-pe colred">
						<span>￥</span>
						<span class="ft25">0</span>
					</div>
				</div>
			</div>
			<div class="ub testline"></div>
		</div>
		<!--视频列表-->
		<div class="ub ub-ver datalist paperbox" id="videolist">
			<div class="ub ctrlbox">
				<div class="ub ub-ac ub-f1">
					购买数量
				</div>
				<div class="ub buycontral">
					<div class="ub ub-ac ub-pc ft125 ctrlL pro-reduce">
						-
					</div>
					<div class="ub ub-ac ub-pc ctrlN pro-num">
						0
					</div>
					<div class="ub ub-ac ub-pc ft125 ctrlR pro-add">
						+
					</div>
				</div>
			</div>
			<div class="ub ub-ac delivebox">
				<div class="ub ub-ac ub-f1">
					配送方式
				</div>
				<div class="ub ub-ac">
					<span class="marr1 colgloden ft09">快递  免邮</span>
					<span class="ub ub-f1 ub-pe fa ft15 colc8 fa-angle-right"></span>
				</div>
			</div>
			<div class="ub ub-ac delivebox">
				<div class="ub ub-ac ub-f1">
					发货时间
				</div>
				<div class="ub ub-ac">
					<span class="marr1 ft09">按进度计划发货</span>
					<span class="ub ub-f1 ub-pe fa ft15 colc8 fa-angle-right"></span>
				</div>
			</div>
			<div class="ub ub-ac delivebox">
				<div class="ub ub-ac ub-f1">
					联系客服
				</div>
				<div class="ub ub-ac">
					<span class="marr1"></span>
					<span class="ub ub-f1 ub-pe fa ft15 colc8 fa-angle-right"></span>
				</div>
			</div>
		</div>
		<div class="ub ub-ver datalist file_list dhide" id="filelist">
			<div class="ub ub-ver cont_flash bc-white">
				<div class="ub  bc-white ub-ac ub-pe marb06 marr06 umar-t">
					<span class="colred curpage">1</span>
					<span>/</span>
					<span class="totalpage">0</span>
				</div>
				<!--文档列表-->
				<div class="flash">
					<div class="swiper-container ub ub-f1">
						<div class="ub swiper-wrapper" style="height: 100% !important;">

						</div>
						<div class="swiper-pagination dhide"></div>
						<div class="swiper-button-next swiper-button-white"></div>
						<div class="swiper-button-prev swiper-button-white"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="ub ub-ac ub-pc sc-text footer_line dhide" style="padding-bottom: 0.6em;">
			<span class="ub warmline"></span>
			<span class="ub ft09">暂无更多考卷信息</span>
			<span class="ub warmline"></span>
		</div>
		<div class="ub ub-ac buyfooter">
			<div class="ub ub-pc ub-f1">
				<span>合计：</span><span class="totalnum">0</span>
				<span class="marr1">份</span>
				<span class="colgloden">￥</span><span class="colgloden ft125">0</span>
			</div>
			<div class="ub ub-f1 ub-pc ub-ac buybtn">立即购买</div>
		</div>
	</body>

</html>
<script src="common/js/jquery-2.1.4.min.js"></script>
<script src="common/js/swiper.min.js"></script>
<script src="common/js/mui.min.js"></script>
<script src="Fsuperjs/Fsuper.js"></script>
<script>
	$(function() {
		var top_hight = $('.test_wraptop').height();
		$('.datalist').css('padding-top', top_hight);
		//gettestinfor();
		//getresolvelist();
		//checkvideo();
		//gettestpdf();
	});
	var examId = localStorage.getItem("examId");
	var videourl, isGet;

	function moveNext(object, index) {
		if(object.value.length == 4) {
			$('.codetxt')[index + 1].focus();
		}
	}
	
	//商品加减
	var goods_reduce = $(".pro-reduce"); //减少商品按钮
		var goods_add = $(".pro-add"); //增加商品数量
		var num = "";
		
		/*添加数量的方法*/
		$(goods_add).click(function() {
			var goods_num = $(".pro-num"); //增加前商品数量
			num = $(goods_num).text();
			num++;
			//appcan.locStorage.remove("FgoodsNum");
			goods_num.text(num); //增加后商品数量
			$('.totalnum').text(num);
			//ajax代码可以放这里传递到数据库实时改变总价  
		});

		/*减少数量的方法*/
		$(goods_reduce).click(function() {
			//如果文本框的值大于0才执行减去方法  
			var goods_num = $(".pro-num");
			num = $(goods_num).text();
			if(num > 0) {
				//并且当文本框的值为1的时候，减去后文本框直接清空值，不显示0  
				if(num == 0) {
					num--;
					goods_num.val("0");
				}
				//否则就执行减减方法  
				else {
					num--;
					goods_num.text(num);
					$('.totalnum').text(num);
				}
			}
		});

	//获取考卷基本信息
	var curkey = "";
	//获取考卷基本信息
	function gettestinfor() {
		var furl = "/YNAPIManage/WeChatApi/GetExamDocument?examId=" + examId;
		var finetest_name = localStorage.getItem("finetest_name");
		var finetest_class = localStorage.getItem("finetest_class");
		var resolve_type = localStorage.getItem("resolve_type");
		var IsNeedValid = localStorage.getItem("IsNeedValid");
		var subject_img = localStorage.getItem("subject_img");
		var testlook = localStorage.getItem("testlook");
		$(".finetest_class").text(finetest_class);
		$(".finetest_name").text(finetest_name);
		$(".IsNeedValid").text(IsNeedValid);
		$(".subject_img").attr("src", subject_img);
		$('.testlook').text(testlook);
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type == 1) {
					curkey = result.resultdata.Key;
					var finetest_name = localStorage.setItem("curkey", curkey);
					//					var Watch = result.resultdata.Watch;
					//					if(Watch == null || Watch == '') {
					//						Watch = 0
					//					}
					//					$('.testlook').text(Watch);
				} else {
					//mui.toast(result.message);
				}
			},
			error: function() {
				mui.toast("网络错误");

			}

		});
	}
	//获取考卷PDF信息
	function gettestpdf() {
		var furl = "/YNAPIManage/WeChatApi/GetPDFPages?key=" + curkey;
		var finetest_name = localStorage.getItem("finetest_name");
		var finetest_class = localStorage.getItem("finetest_class");
		var resolve_type = localStorage.getItem("resolve_type");
		var IsNeedValid = localStorage.getItem("IsNeedValid");
		$(".finetest_class").text(finetest_class);
		$(".finetest_name").text(finetest_name);
		$(".IsNeedValid").text(IsNeedValid);
		$(".load-wrapper").removeClass('dhide');
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				$(".load-wrapper").addClass('dhide');
				if(result.type == 1) {
					var imgHtml = "";
					for(var i = 0; i < result.resultdata.pages; i++) {
						var src = Serverurl + "/YNAPIManage/WeChatApi/URIImage?key=" + curkey + "&page=" + (i + 1);
						img = '<div onclick="" class="swiper-slide"><img src=' + src + ' style = "width:100%; height:100%"  /></div>'
						$(".swiper-wrapper").append(img);
					}
					var swiper = new Swiper('.swiper-container', {
						loop: false,
						grabCursor: true,
						paginationClickable: true,
						navigation: {
							nextEl: '.swiper-button-next',
							prevEl: '.swiper-button-prev',
						},
						pagination: {
							el: '.swiper-pagination',
							type: 'fraction',
						}
					});
					$(".load-wrapper").addClass('dhide');

				} else {
					$(".cont_flash").addClass("dhide");
					$(".load-wrapper").addClass('dhide');
					//mui.toast(result.message);
				}
			},
			error: function() {
				mui.toast("网络错误");
				$(".cont_flash").addClass("dhide");
				$(".load-wrapper").addClass('dhide');
			}

		});
	}

	//获取精品考卷列表
	function getresolvelist() {
		var furl = "/YNAPIManage/WeChatApi/GetExamVideoList?examId=" + examId;
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type == 1) {
					var datas = result.resultdata;
					var length = datas.length;
					if(length > 0) {
						for(var i = 0; i < length; i++) {
							addresolve(datas[i]);
						}
					}
				} else {
					//mui.toast(result.message);
				}

			},
			error: function() {
				mui.toast("网络错误");
			}

		});
	}

	function addresolve(data) {
		var list = $(".video_list");
		var item = $(".video_temp .video_item").clone();
		var cururl = data.Url;
		var video_name = data.Name;
		var cuename = video_name.replace('.mp4', '');
		var subject_img = localStorage.getItem("subject_img");
		item.find(".video_page").attr("src", subject_img);
		//cururl = cururl + '.mp4';
		var videolook = data.Watch;
		if(videolook == null || videolook == '') {
			videolook = 0
		}
		console.log(videolook);
		item.attr('onclick', "lookvideo(this)");
		item.attr("id", data.Id);
		item.attr("IsNeedValid", data.IsNeedValid);
		item.attr("videourl", cururl);
		item.find(".video_name").text(cuename);
		item.find(".IsNeedValid").text(data.IsNeedValid);
		//		item.find(".finetest_time").text();
		item.find(".videolook").text(videolook);
		//		item.find(".resolve_type").text(data.ExamModel);
		list.append(item);
	}
	//考卷列表点击
	function lookvideo(dom) {
		var videoid = $(dom).attr("id");
		videourl = $(dom).attr("videourl");
		var IsNeedValid = $(dom).attr("IsNeedValid");
		var video_name = $(dom).find(".video_name").text();
		var watchdata = {
			bus: 1,
			table: 1,
			id: videoid
		}
		localStorage.setItem("video_name", video_name);
		listenerlook(watchdata);
		if(isGet == '未授权') {
			$(".testmask").addClass("mui-active").removeClass("dhide");
		} else {
			localStorage.setItem("videourl", videourl);
			mui.openWindow({
				url: 'videoplay.html',
				id: 'videoplay',
			});
		}
	}

	//验证视频授权
	function checkvideo() {
		var furl = '/YNAPIManage/WeChatApi/CheckGetAuthorize?examId=' + examId;
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type == 1) {
					isGet = result.resultdata.isGet;
				} else {
					isGet = '未授权';
					mui.toast(result.message);
				}
			},
			error: function() {
				mui.toast("网络错误");
			}

		});
	}
	//考卷授权
	$(".surebtn").on('click', function() {
		getvideocode();
	})

	function getvideocode() {
		var codetxt01 = $('.codetxt01').val();
		var codetxt02 = $('.codetxt02').val();
		var codetxt03 = $('.codetxt03').val();

		var examecode = codetxt01 + '-' + codetxt02 + '-' + codetxt03;
		if(examecode == "" || examecode == null) {
			mui.toast('请输入试卷号')
			return;
		}
		var senddata = {
			examId: examId,
			code: examecode
		}
		var furl = '/YNAPIManage/WeChatApi/BindCodeAuthorize';
		$.ajax({
			url: Serverurl + furl,
			type: "POST",
			async: false,
			dataType: "json",
			data: senddata,
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				var message = result.message;
				if(message == "授权成功") {
					localStorage.setItem("videourl", videourl);
					mui.openWindow({
						url: 'videoplay.html',
						id: 'videoplay',
					});
				} else {
					mui.toast(message);
				}
			},
			error: function() {
				mui.toast("网络错误");
			}

		});
	}

	//试卷输入框点击
	$(".testmask,.exitbtn").on("click", function() {
		$(".testmask").removeClass("mui-active").addClass("dhide");
	})
	$(".maskmain").on("click", function() {
		event.stopPropagation();
	})

	//头部导航点击
	$(".switch_navitem").click(function() {
		var dom = $(this);
		var navitem = $(".switch_navitem");
		var curid = $(this).attr("id");
		curlist = curid + "list";
		navanimation(dom, navitem);
		$(".datalist").addClass("dhide");
		$("#" + curlist).removeClass("dhide");
	});
</script>