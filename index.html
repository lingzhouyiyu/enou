<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title>一诺教育</title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="common/css/mui.min.css" rel="stylesheet" />
		<link href="common/css/fonts/font-awesome.min.css" rel="stylesheet" />
		<link href="common/css/swiper.min.css" rel="stylesheet" />
		<link href="common/css/icon.css" rel="stylesheet" />
		<link href="common/css/ui-base.css" rel="stylesheet" />
		<link href="common/css/ui-box.css" rel="stylesheet" />
		<link href="common/css/ui-color.css" rel="stylesheet" />
		<link href="common/css/common.css" rel="stylesheet" />
		<link href="common/css/control.css" rel="stylesheet" />
		<link href="maincss/index.css" rel="stylesheet" />

	</head>

	<body class="bc-text um-vp bc-bg">
		<div class="ub ub-ver mainpage">
			<div class="flash">
				<div class="swiper-container ub ub-f1">
					<div class="ub ub-ac swiper-wrapper" style="height: auto !important;">
						<div class="swiper-slide" style="height: auto !important;">
							<div class="flash_img">
								<img class="ub-img" src="common/images/slide01.jpg" />
							</div>
						</div>
						<div class="swiper-slide" style="height: auto !important;">
							<div class="flash_img">
								<img class="ub-img" src="common/images/slide02.jpg" />
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="ub ub-ac wrap_note">
				<div class="ub col999 umar-r ft09 fa fa-volume-up ft09 colgop">
				</div>
				<div class="ub note_listbox scroll">
					<div class="ub ub-f1 ub-ver note_list">
						<div class="ub ub-f1 note_item txthide ft09 colgop">
							新用户请先到个人中心绑定手机号！
						</div>
					</div>
				</div>
			</div>
			<div id="testPay" class="ub ub-ac wrap_note">
				<div class="ub col999 umar-r ft09 fa fa-volume-up ft09 colgop">
				</div>
				<div class="ub note_listbox scroll">
					<div class="ub ub-f1 ub-ver note_list">
						<div class="ub ub-f1 note_item txthide ft09 colgop">
							捐献1块钱
						</div>
					</div>
				</div>
			</div>
			<div class="ub ub-ver wrap_mainnav">
				<div class="ub ub-f1 marb1">
					<div class="ub ub-f1 ub-ver ub-fh gofree">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav01.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">免费专区</div>
					</div>
					<div class="ub ub-f1 ub-ver ub-fh gofine">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav02.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">精品课程</div>
					</div>
					<div class="ub ub-f1 ub-ver ub-fh gotest">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav03.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">精品考卷</div>
					</div>
					<div class="ub ub-f1 ub-ver ub-fh goresolve">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav04.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">考卷解析</div>
					</div>
				</div>
				<div class="ub ub-f1">
					<div class="ub ub-f1 ub-ver ub-fh orderexam">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav06.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">考卷订购</div>
					</div>
					<div class="ub ub-f1 ub-ver ub-fh godownload">
						<div class="ub ub-ac ub-pc">
							<img class="index_navimg" src="common/images/index_nav05.png" />
						</div>
						<div class="ub ub-ac ub-pc ft09 col999">资源下载</div>
					</div>
					<div class="ub ub-f1 ub-ver ub-fh">

					</div>
					<div class="ub ub-f1 ub-ver ub-fh">

					</div>
				</div>
			</div>
			<div class="ub block_nav">
				<div class="ub ub-f1">
					<div class="ub ub-ac nav_line"></div>
					<div class="ub ub-ac ub-pc">免费专区</div>
				</div>
				<div class="ub ub-ac sc-text">
					<span class="ft085 umar-r">更多</span>
					<span class="ub fa fa-angle-right"></span>
				</div>
			</div>
			<!--免费专区-->
			<div class="ub bc-text free_list">
				<div class="ub ub-ver ub-f1 ub-fh free_listL free_list0">
					<div class="ub ub-ver free_item">
						<div class="ub free_img">
							<img src="common/images/free02.jpg" />
						</div>
						<div class="ub ub-ac ub-pc free_title txthide">
							小学数学精品课程免费学习
						</div>
					</div>

				</div>
				<div class="ub ub-ver ub-f1 ub-fh free_listR free_list0">
					<div class="ub ub-ver free_item">
						<div class="ub free_img">
							<img src="common/images/free01.jpg" />
						</div>
						<div class="ub ub-ac ub-pc free_title txthide">
							小学数学精品课程免费学习
						</div>
					</div>
				</div>
			</div>
			<!--考卷解析-->
			<div class="ub block_nav02">
				<div class="ub ub-f1">
					<div class="ub ub-ac nav_line02"></div>
					<div class="ub ub-ac ub-pc">考卷解析</div>
				</div>
				<div class="ub ub-ac sc-text">
					<span class="ft085 umar-r">更多</span>
					<span class="ub fa fa-angle-right"></span>
				</div>
			</div>
			<div class="ub ub-ver fine_list resolve_list">

			</div>
			<!--精品课程-->
			<div class="ub block_nav03">
				<div class="ub ub-f1">
					<div class="ub ub-ac nav_line03"></div>
					<div class="ub ub-ac ub-pc">精品课程</div>
				</div>
				<div class="ub ub-ac sc-text">
					<span class="ft085 umar-r">更多</span>
					<span class="ub fa fa-angle-right"></span>
				</div>
			</div>
			<div class="ub ub-ver fine_list">
				<div class="ub fine_item">
					<div class="ub fine_img">
						<img src="common/images/free01.jpg" />
					</div>
					<div class="ub ub-ver ub-f1 fine_right">
						<div class="ub bc-text txthide">2018年高考真题解析</div>
						<div class="ub sc-text ft085 umar-t umar-b">
							<span>数学</span>
							<span>|</span>
							<span>3</span><span>课时</span>
						</div>
						<div class="ub sc-text">
							<div class="ub ub-f1 ft085">
								<span>100</span><span>人已观看</span>
							</div>
							<div class="ub colred">免费</div>
							<div class="colred payfree dhide">
								<span class="ft085">￥</span><span class="ft125">0</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--一诺新闻-->
			<div class="ub block_nav04">
				<div class="ub ub-f1">
					<div class="ub ub-ac nav_line04"></div>
					<div class="ub ub-ac ub-pc">一诺新闻</div>
				</div>
				<div class="ub ub-ac sc-text">
					<span class="ft085 umar-r">更多</span>
					<span class="ub fa fa-angle-right"></span>
				</div>
			</div>
			<div class="ub ub-ver news_list">

			</div>
			<div class="ub ub-ac ub-pc sc-text footer_line">
				<span class="ub warmline"></span>
				<span class="ub ft09">我是有底线的</span>
				<span class="ub warmline"></span>
			</div>
			<!--脚部-->
			<div class="ub footer">
				<div class="ub ub-ver ub-ac ub-pc ub-f1 ub-fh" onclick="goindex()">
					<div class="ub footer_img">
						<img class="dhide" src="common/images/foot01.png" />
						<img src="common/images/foot01_active.png" />
					</div>
					<div class="ub ft085 colblue">首页</div>
				</div>
				<div class="ub ub-ver ub-ac ub-pc ub-f1 ub-fh" onclick="gocourse()">
					<div class="ub footer_img">
						<img src="common/images/foot02.png" />
						<img class="dhide" src="common/images/foot02_active.png" />
					</div>
					<div class="ub ft085 col999">课程</div>
				</div>
				<div class="ub ub-ver ub-ac ub-pc ub-f1 ub-fh" onclick="goperson()">
					<div class="ub footer_img">
						<img src="common/images/foot03.png" />
						<img class="dhide" src="common/images/foot03_active.png" />
					</div>
					<div class="ub ft085 col999">个人</div>
				</div>
			</div>
		</div>
		<!--考卷解析-->
		<div class="resolve_temp dhide">
			<div class="ub fine_item resolve_item">
				<div class="ub fine_img">
					<img class="subject_img" src="" />
				</div>
				<div class="ub ub-ver ub-pc ub-f1 fine_right">
					<div class="ub bc-text txthide resolve_name"></div>
					<div class="ub ub-ac sc-text ft085 umar-t umar-b">
						<span class="leseeon_sign resolve_class"></span>
						<span class="resolve_grade"></span>
						<span>|</span>
						<span class="resolve_type"></span>
					</div>
					<div class="ub sc-text">
						<div class="ub ub-f1 ft085">
							<span class="resolve_time"></span>
						</div>
						<div class="ub colred dhide">免费</div>
					</div>
				</div>
			</div>
		</div>
		<!--新闻-->
		<div class="newstemp dhide">
			<div class="ub ub-ac news_item">
				<div class="ub news_img">
					<img class="news_page" src="common/images/free01.jpg" />
				</div>
				<div class="ub ub-ver ub-f1 news_right">
					<div class="ub bc-text Fnewstitle txthide"></div>
					<div class="ub sc-text ft085 txthide Fnewstxt umar-t umar-b">

					</div>
					<div class="ub sc-text dhide">
						<div class="ub ub-f1 Fnewstime ft085">
							2018-12-09
						</div>
						<div class="ub">
							<div class="ub ub-ac">
								<img class="ub ub-img track_img" src="common/images/track.png" />
							</div>
							<div class="ub ub-ac ub-pc ft085 ub-pc">
								<span class="Fnewslook">0</span><span>浏览</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="ub follow-box dhide" style="position: fixed; left: 0; top: 0; background: rgba(0,0,0,0.5); z-index: 999; width: 100%; padding: 0.4em 0.6em;">
			<div class="ub ub-ac colse-follow" style="width: 3.6em;">
				<span class="fa fa-close ft125 colwhite"></span>
			</div>
			<div class="ub ub-ac ub-pe ub-f1 gofollow">
				<div class="ub ub-ac ub-pc" style="background: red; color: #fff; padding:3px 0.6em; border-radius: 5px;">
					关注
				</div>
			</div>
		</div>
	</body>

</html>
<script src="common/js/jquery-2.1.4.min.js"></script>
<script src="common/js/swiper.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="common/js/mui.min.js"></script>
<script src="Fsuperjs/Fsuper.js"></script>
<script>
	var msgId, msgKey, Phone;
	$(function() {
		var u = navigator.userAgent;
		var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
		var sure_refresh = sessionStorage.getItem("sure_refresh");
		if(sure_refresh) {
			sessionStorage.removeItem("sure_refresh");
			window.location.reload();
		}
		if(isiOS) {
			iosrefresh();
		}

		//幻灯片
		var swiper = new Swiper('.swiper-container', {
			loop: true,
			grabCursor: true,
			paginationClickable: true,
			autoplay: 5000,
		}); 

		var loginurl = '/Login/LoginCheck007';
		var userurl = '/YNAPIManage/WeChatApi/GetUserInfo';
		$.ajax({
			url: Serverurl + loginurl,
			async: false,
			type: 'GET',
			timeout: 50000,
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			error: function() {

			},
			success: function(result) {
				$.ajax({
					url: Serverurl + userurl,
					async: false,
					type: 'GET',
					timeout: 50000,
					crossDomain: true,
					xhrFields: {
						withCredentials: true
					},
					error: function() {

					},
					success: function(result) {
						result = JSON.parse(result);
					}
				})
			}
		});

		//截取msgId
		$.getUrlParam = function(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
			var r = window.location.search.substr(1).match(reg);
			if(r != null) return decodeURIComponent(r[2]);
			return null;
		}
		msgId = $.getUrlParam("msgId");
		getguid();
		getjssdk();
		//checkbind();
		checktel();
		checkshare();
		checkfollow();
		getresolvelist();
		getnewslist();

	});

	//获取考卷解析列表
	function getresolvelist() {
		var furl = "/YNAPIManage/WeChatApi/GetExamList";
		senddata = {
			name: '',
			subject: '',
			grade: '',
			rows: 5,
			page: 1,
			port: 0
		}
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			data: senddata,
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				var datas = result.resultdata;
				var length = datas.rows.length;
				if(length > 0) {
					for(var i = 0; i < length; i++) {
						addresolve(datas.rows[i]);
					}
				}

			},
			error: function() {
				mui.toast("网络错误")
			}

		});
	}

	function addresolve(data) {
		var list = $(".resolve_list");
		var item = $(".resolve_temp .resolve_item").clone();
		var subject = data.Subject;
		if(subject == '语文') {
			item.find(".subject_img").attr("src", "common/images/chinese.jpg");
		} else if(subject == '数学') {
			item.find(".subject_img").attr("src", "common/images/math.jpg");
		} else if(subject == '英语') {
			item.find(".subject_img").attr("src", "common/images/english.jpg");
		} else if(subject == '化学') {
			item.find(".subject_img").attr("src", "common/images/chem.jpg");
		} else if(subject == '物理') {
			item.find(".subject_img").attr("src", "common/images/physics.jpg");
		} else {
			item.find(".subject_img").attr("src", "common/images/default.jpg");
		}
		item.attr('onclick', "resolveDetail(this)");
		item.attr("id", data.Id);
		item.attr("IsNeedValid", data.IsNeedValid);
		item.find(".resolve_name").text(data.Name);
		item.find(".resolve_class").text(subject);
		item.find(".resolve_grade").text(data.Grade);
		item.find(".resolve_time").text();
		item.find(".resolve_type").text(data.ExamModel);
		item.attr("testlook", data.Watch);
		list.append(item);
	}
	//考卷解析列表点击
	function resolveDetail(dom) {
		var examId = $(dom).attr("id");
		var testlook = $(dom).attr("testlook");
		//var UseTime = $(dom).find(".depart_time").text();
		var finetest_name = $(dom).find(".resolve_name").text();
		var finetest_class = $(dom).find(".resolve_class").text();
		var resolve_type = $(dom).find(".resolve_type").text();
		var IsNeedValid = $(dom).attr("IsNeedValid");
		var subject_img = $(dom).find(".subject_img").attr("src");
		var watchdata = {
			bus: 0,
			table: 0,
			id: examId
		}
		localStorage.setItem("finetest_name", finetest_name);
		localStorage.setItem("finetest_class", finetest_class);
		localStorage.setItem("resolve_type", resolve_type);
		localStorage.setItem("IsNeedValid", IsNeedValid);
		localStorage.setItem("examId", examId);
		localStorage.setItem("subject_img", subject_img);
		localStorage.setItem("testlook", testlook);
		mui.openWindow({
			url: 'testdetail.html',
			id: 'testdetail',
		});
		listenerlook(watchdata);
	}
	//新闻列表
	function getnewslist() {
		var furl = "/PublicWeChatApi/GetNewsList";
		senddata = {
			name: '',
			subject: '',
			grade: '',
			rows: 5,
			page: 1
		}
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			data: senddata,
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				var datas = result.resultdata;
				var length = datas.length;
				if(length > 0) {
					for(var i = 0; i < length; i++) {
						addnews(datas[i]);
					}
				}

			},
			error: function() {
				mui.toast("网络错误")
			}

		});
	}

	function addnews(data) {
		var list = $(".news_list");
		var item = $(".newstemp .news_item").clone();
		item.attr('onclick', "newsDetail(this)");
		item.attr("id", data.Id);
		item.find(".Fnewstitle").text(data.Title);
		//item.find(".Fnewstime").text(data.Date);
		item.find(".news_page").attr("src", "common/images/news_bg.jpg");
		list.append(item);
	}
	//新闻点击
	function newsDetail(dom) {
		var newsid = $(dom).attr("id");
		localStorage.setItem("newsid", newsid);
		mui.openWindow({
			url: 'newsdetail.html',
			id: 'newsdetail',
		});
	}
	//检查是否绑定电话
	function checktel() {
		var furl = "/YNAPIManage/WeChatApi/GetUserInfo";
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type == 1) {
					Phone = '';
					if(Phone == null || Phone == '') {
						var btnArray = ['否', '是'];
						mui.confirm('绑定手机号获得更多免费资源？', '系统提示', btnArray, function(e) {
							if(e.index == 1) {
								mui.openWindow({
									url: 'bindtel.html'
								});
							} else {
								return;
							}
						})
					}

				}
			},
			error: function() {
				//mui.toast("网络错误");
			}

		});
	}

	//判断是否有分享
	function checkshare() {
		if(msgId != '' && msgId != null) {
			checkbind();
		}
	}

	//获取JSSDK配置,分享给父母
	function getjssdk() {
		var furl = "/YNAPIManage/WeChatApi/GetJSSDKConfig";
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {

				if(result.type === 1) {
					wx.config({
						debug: false,
						appId: result.resultdata.AppId,
						timestamp: result.resultdata.Timestamp,
						nonceStr: result.resultdata.NonceStr,
						signature: result.resultdata.Signature,
						jsApiList: [
							'onMenuShareAppMessage'
						]
					});

					wx.error(function(res) {
						//alert(JSON.stringify(res));
					});
				}

			},
			error: function() {}
		});
	}

	//获取GUID
	function getguid() {
		var furl = "/YNAPIManage/WeChatApi/CreateGuid";
		$.ajax({
			url: Serverurl + furl,
			type: "get",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type === 1) {
					msgKey = result.resultdata;
					wx.ready(function() {
						wx.checkJsApi({
							jsApiList: [
								'onMenuShareAppMessage'
							],
							success: function(res) {
								//alert(JSON.stringify(res))
							}
						})

						wx.onMenuShareAppMessage({
							title: "分享给父母",
							desc: "分享给父母，让父母绑定自己",
							link: 'http://edu.enuo100.cn/Wechat/yinuo/views/index.html?msgId=' + msgKey,
							imgUrl: '',
							type: 'link',
							success: function() {
								//去调用发送简易绑定MSG信息
								//同时调用CreateGuid更换msgKey
								sendbandmsg();
								getguid();
							},
							cancel: function() {
								//不调用此信息
							}
						})
					});
				}

			},
			error: function() {

			}
		});
	}

	//微信简易绑定消息发送 
	function sendbandmsg() {
		var furl = "/YNAPIManage/WeChatApi/EasyCustodyBindMsg?msgId=" + msgId;
		$.ajax({
			url: Serverurl + furl,
			type: "POST",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				mui.toast(result.message);

			},
			error: function() {

			}
		});
	}

	//检查是否绑定
	function checkbind() {
		var furl = "/YNAPIManage/WeChatApi/CheckCustodyBind?msgId=" + msgId;
		$.ajax({
			url: Serverurl + furl,
			type: "GET",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.resultdata === '未绑定') {
					var btnArray = ['否', '是'];
					mui.confirm('是否绑定监护人？', '系统提示', btnArray, function(e) {
						if(e.index == 1) {
							surebind();
						} else {
							return;
						}
					})

				}
			},
			error: function() {

			}
		});
	}
	//确认绑定
	function surebind() {
		var furl = "/YNAPIManage/WeChatApi/BindCustody?msgId=" + msgId;
		$.ajax({
			url: Serverurl + furl,
			type: "POST",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type === 1) {
					mui.toast(result.message);
					window.location.reload();
				} else {
					mui.toast(result.message);
				}
			},
			error: function() {

			}
		});
	}

	//检查是否关注过
	function checkfollow() {
		var furl = "/YNAPIManage/WeChatApi/IsWatchWechat";
		$.ajax({
			url: Serverurl + furl,
			type: "GET",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.message === '未关注') {
					$('.follow-box').removeClass("dhide");
				}
			},
			error: function() {

			}
		});
	}
	$('.colse-follow').on('click', function() {
		$('.follow-box').addClass("dhide");
	})

	$(".fine_item,.free_item").click(function() {
		mui.openWindow({
			url: 'lessonlist.html'
		});
	})

	$(".block_nav03,.block_nav,.gofine,.gofree").click(function() {
		mui.openWindow({
			url: 'lessonlist.html'
		});
	})

	$(".gotest").click(function() {
		mui.openWindow({
			url: 'examlist.html'
		});
	});

	$(".block_nav04").click(function() {
		mui.openWindow({
			url: 'newslist.html'
		});
	});
	$(".block_nav02,.goresolve").click(function() {
		mui.openWindow({
			url: 'testlist.html'
		});
	});
	$(".godownload").click(function() {
		mui.openWindow({
			url: 'download.html'
		});
	})
	$(".orderexam").click(function() {
		mui.openWindow({
			url: 'orderexam.html'
		});
	});
	$('.gofollow').on('click', function() {
		var furl = "/YNAPIManage/WeChatApi/GetSubscribeLink";
		$.ajax({
			url: Serverurl + furl,
			type: "GET",
			async: false,
			dataType: "json",
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			success: function(result) {
				if(result.type === 1) {
					var followlink = result.resultdata;
					mui.openWindow({
						url: followlink
					});
				}
			},
			error: function() {

			}
		});
	})
</script>